<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>stumpless: sqlite3_example.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">stumpless<span id="projectnumber">&#160;2.2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('sqlite3_example_8c-example.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">sqlite3_example.c</div></div>
</div><!--header-->
<div class="contents">
<p>Demonstrates how to work with a sqlite3 target.</p>
<p>Demonstrates how to work with a sqlite3 target.</p><dl class="section since"><dt>Since</dt><dd>release v2.2.0</dd></dl>
<div class="fragment"><div class="line"><span class="comment">// SPDX-License-Identifier: Apache-2.0</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Copyright 2023 Joel E. Anderson</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment"> * You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment"> * limitations under the License.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sqlite3_8h.html">sqlite3.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stddef.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="stumpless_8h.html">stumpless.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// an array of prepared statements to use in our custom prepare function</span></div>
<div class="line"><span class="keyword">static</span> sqlite3_stmt *card_stmts[2] = { NULL, NULL };</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> *</div>
<div class="line">card_played_prepare( <span class="keyword">const</span> <span class="keyword">struct</span> <a id="_a0" name="_a0"></a><a class="code hl_struct" href="structstumpless__entry.html">stumpless_entry</a> *entry,</div>
<div class="line">                     <span class="keywordtype">void</span> *data,</div>
<div class="line">                     <span class="keywordtype">size_t</span> *count ) {</div>
<div class="line">  sqlite3 *db = data;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *card_insert_sql = <span class="stringliteral">&quot;INSERT INTO played_cards ( suit, rank ) &quot;</span></div>
<div class="line">                                <span class="stringliteral">&quot;VALUES ( $suite, $rank )&quot;</span>;</div>
<div class="line">  <span class="keywordtype">int</span> sql_result;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *player_insert_sql = <span class="stringliteral">&quot;INSERT INTO taken_turns ( player_name ) &quot;</span></div>
<div class="line">                                  <span class="stringliteral">&quot;VALUES ( $name )&quot;</span>;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *suit;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *rank;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *name;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>( !card_stmts[0] ) {</div>
<div class="line">    sql_result = sqlite3_prepare_v2( db,</div>
<div class="line">                                     card_insert_sql,</div>
<div class="line">                                     -1,</div>
<div class="line">                                     &amp;card_stmts[0],</div>
<div class="line">                                     NULL );</div>
<div class="line">    <span class="keywordflow">if</span>( sql_result != SQLITE_OK ) {</div>
<div class="line">      printf( <span class="stringliteral">&quot;couldn&#39;t prepare the played_cards insert stmt: %s\n&quot;</span>,</div>
<div class="line">              sqlite3_errmsg( db ) );</div>
<div class="line">      <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    sqlite3_reset( card_stmts[0] );</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>( !card_stmts[1] ) {</div>
<div class="line">    sql_result = sqlite3_prepare_v2( db,</div>
<div class="line">                                     player_insert_sql,</div>
<div class="line">                                     -1,</div>
<div class="line">                                     &amp;card_stmts[1],</div>
<div class="line">                                     NULL );</div>
<div class="line">    <span class="keywordflow">if</span>( sql_result != SQLITE_OK ) {</div>
<div class="line">      printf( <span class="stringliteral">&quot;couldn&#39;t prepare the taken_turns insert stmt: %s\n&quot;</span>,</div>
<div class="line">              sqlite3_errmsg( db ) );</div>
<div class="line">      <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    sqlite3_reset( card_stmts[1] );</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  suit = <a id="a1" name="a1"></a><a class="code hl_function" href="entry_8h.html#a7714fe32f587fcf407aac0728eda867f">stumpless_get_entry_param_value_by_name</a>( entry, <span class="stringliteral">&quot;card&quot;</span>, <span class="stringliteral">&quot;suit&quot;</span> );</div>
<div class="line">  rank = <a class="code hl_function" href="entry_8h.html#a7714fe32f587fcf407aac0728eda867f">stumpless_get_entry_param_value_by_name</a>( entry, <span class="stringliteral">&quot;card&quot;</span>, <span class="stringliteral">&quot;rank&quot;</span> );</div>
<div class="line">  name = <a class="code hl_function" href="entry_8h.html#a7714fe32f587fcf407aac0728eda867f">stumpless_get_entry_param_value_by_name</a>( entry, <span class="stringliteral">&quot;player&quot;</span>, <span class="stringliteral">&quot;name&quot;</span> );</div>
<div class="line"> </div>
<div class="line">  sql_result = sqlite3_bind_text( card_stmts[0],</div>
<div class="line">                                  1,</div>
<div class="line">                                  suit,</div>
<div class="line">                                  -1,</div>
<div class="line">                                  SQLITE_TRANSIENT );</div>
<div class="line">  <span class="keywordflow">if</span>( sql_result != SQLITE_OK ) {</div>
<div class="line">      printf( <span class="stringliteral">&quot;couldn&#39;t bind the card suit: %s\n&quot;</span>,</div>
<div class="line">              sqlite3_errmsg( db ) );</div>
<div class="line">      <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  sql_result = sqlite3_bind_text( card_stmts[0],</div>
<div class="line">                                  2,</div>
<div class="line">                                  rank,</div>
<div class="line">                                  -1,</div>
<div class="line">                                  SQLITE_TRANSIENT );</div>
<div class="line">  <span class="keywordflow">if</span>( sql_result != SQLITE_OK ) {</div>
<div class="line">      printf( <span class="stringliteral">&quot;couldn&#39;t bind the card rank: %s\n&quot;</span>,</div>
<div class="line">              sqlite3_errmsg( db ) );</div>
<div class="line">      <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  sql_result = sqlite3_bind_text( card_stmts[1],</div>
<div class="line">                                  1,</div>
<div class="line">                                  name,</div>
<div class="line">                                  -1,</div>
<div class="line">                                  SQLITE_TRANSIENT );</div>
<div class="line">  <span class="keywordflow">if</span>( sql_result != SQLITE_OK ) {</div>
<div class="line">      printf( <span class="stringliteral">&quot;couldn&#39;t bind the player name: %s\n&quot;</span>,</div>
<div class="line">              sqlite3_errmsg( db ) );</div>
<div class="line">      <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  free( ( <span class="keywordtype">char</span> * ) suit );</div>
<div class="line">  free( ( <span class="keywordtype">char</span> * ) rank );</div>
<div class="line">  free( ( <span class="keywordtype">char</span> * ) name );</div>
<div class="line"> </div>
<div class="line">  *count = 2;</div>
<div class="line">  <span class="keywordflow">return</span> &amp;card_stmts;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv ) {</div>
<div class="line">  <span class="keyword">struct </span><a id="_a2" name="_a2"></a><a class="code hl_struct" href="structstumpless__target.html">stumpless_target</a> *db_target;</div>
<div class="line">  <span class="keywordtype">int</span> result = EXIT_SUCCESS;</div>
<div class="line">  sqlite3 *db;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *card_logs_create_sql = <span class="stringliteral">&quot;CREATE TABLE card_logs (&quot;</span></div>
<div class="line">                                     <span class="stringliteral">&quot;  log_id INTEGER PRIMARY KEY,&quot;</span></div>
<div class="line">                                     <span class="stringliteral">&quot;  facility INTEGER NOT NULL,&quot;</span></div>
<div class="line">                                     <span class="stringliteral">&quot;  severity INTEGER NOT NULL,&quot;</span></div>
<div class="line">                                     <span class="stringliteral">&quot;  timestamp TEXT,&quot;</span></div>
<div class="line">                                     <span class="stringliteral">&quot;  structured_data TEXT,&quot;</span></div>
<div class="line">                                     <span class="stringliteral">&quot;  message TEXT )&quot;</span>;</div>
<div class="line">  sqlite3_stmt *card_logs_create_stmt = NULL ;</div>
<div class="line">  <span class="keywordtype">int</span> sql_result;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *card_logs_insert = <span class="stringliteral">&quot;INSERT INTO card_logs ( facility, severity,&quot;</span></div>
<div class="line">                                 <span class="stringliteral">&quot;                        timestamp,&quot;</span></div>
<div class="line">                                 <span class="stringliteral">&quot;                        structured_data,&quot;</span></div>
<div class="line">                                 <span class="stringliteral">&quot;                        message )&quot;</span></div>
<div class="line">                                 <span class="stringliteral">&quot;VALUES ( $facility, $severity, $timestamp,&quot;</span></div>
<div class="line">                                 <span class="stringliteral">&quot;         $structured_data, $message )&quot;</span>;</div>
<div class="line">  <span class="keyword">struct </span><a class="code hl_struct" href="structstumpless__entry.html">stumpless_entry</a> *entry = NULL;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *played_cards_create_sql = <span class="stringliteral">&quot;CREATE TABLE played_cards (&quot;</span></div>
<div class="line">                                        <span class="stringliteral">&quot;  played_card_id INTEGER PRIMARY KEY,&quot;</span></div>
<div class="line">                                        <span class="stringliteral">&quot;  suit TEXT,&quot;</span></div>
<div class="line">                                        <span class="stringliteral">&quot;  rank TEXT&quot;</span></div>
<div class="line">                                        <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line">  sqlite3_stmt *played_cards_create_stmt = NULL;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *taken_turns_create_sql = <span class="stringliteral">&quot;CREATE TABLE taken_turns (&quot;</span></div>
<div class="line">                                       <span class="stringliteral">&quot;  taken_turn_id INTEGER PRIMARY KEY,&quot;</span></div>
<div class="line">                                       <span class="stringliteral">&quot;  player_name TEXT&quot;</span></div>
<div class="line">                                       <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line">  sqlite3_stmt *taken_turns_create_stmt = NULL;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// create the new database (or open the existing one)</span></div>
<div class="line">  db_target = <a id="a3" name="a3"></a><a class="code hl_function" href="sqlite3_8h.html#aed442f2f4b25e58f6798dc7635d491a7">stumpless_open_sqlite3_target</a>( <span class="stringliteral">&quot;stumpless_example.sqlite3&quot;</span> );</div>
<div class="line">  <span class="keywordflow">if</span>( !db_target ) {</div>
<div class="line">    <a id="a4" name="a4"></a><a class="code hl_function" href="error_8h.html#a8dea1c008afff3e4b8900987f5d8e914">stumpless_perror</a>( <span class="stringliteral">&quot;couldn&#39;t open sqlite3 target&quot;</span> );</div>
<div class="line">    result = EXIT_FAILURE;</div>
<div class="line">    <span class="keywordflow">goto</span> cleanup_and_finish;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// create the default logs table (if it doesn&#39;t exist)</span></div>
<div class="line">  <a id="a5" name="a5"></a><a class="code hl_function" href="sqlite3_8h.html#ae8bd442757c8a6bcbaa9c2212f68bbb3">stumpless_create_default_sqlite3_table</a>( db_target );</div>
<div class="line">  <span class="keywordflow">if</span>( <a id="a6" name="a6"></a><a class="code hl_function" href="error_8h.html#ae29b0a3c430cec8b9a165c98482f40e8">stumpless_has_error</a>() ) {</div>
<div class="line">    <span class="comment">// for simplicity, if this fails we simply print a warning and continue</span></div>
<div class="line">    puts( <span class="stringliteral">&quot;could not create default table, perhaps it already exists?&quot;</span> );</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// send a simple message to our new logs table</span></div>
<div class="line">  <a id="a7" name="a7"></a><a class="code hl_function" href="target_8h.html#ad46e8e1c808d895e5b8b349d4a02f90a">stumpless_add_message</a>( db_target, <span class="stringliteral">&quot;cards are on the table&quot;</span> );</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code hl_function" href="error_8h.html#ae29b0a3c430cec8b9a165c98482f40e8">stumpless_has_error</a>() ) {</div>
<div class="line">    <a class="code hl_function" href="error_8h.html#a8dea1c008afff3e4b8900987f5d8e914">stumpless_perror</a>( <span class="stringliteral">&quot;couldn&#39;t send a message to a default SQLite target&quot;</span> );</div>
<div class="line">    result = EXIT_FAILURE;</div>
<div class="line">    <span class="keywordflow">goto</span> cleanup_and_finish;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// after this, an initially empty database would look like this:</span></div>
<div class="line">  <span class="comment">// sqlite&gt; SELECT * FROM logs;</span></div>
<div class="line">  <span class="comment">// log_id      prival      version     timestamp                    hostname    app_name    procid      msgid       structured_data  message</span></div>
<div class="line">  <span class="comment">// ----------  ----------  ----------  ---------------------------  ----------  ----------  ----------  ----------  ---------------  ----------------------</span></div>
<div class="line">  <span class="comment">// 1           14          1           2023-11-22T04:35:02.909888Z  Angus                   3090                                     cards are on the table</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// now, let&#39;s use our own insertion statement</span></div>
<div class="line">  <span class="comment">// we&#39;ll need to create a table</span></div>
<div class="line">  db = <a id="a8" name="a8"></a><a class="code hl_function" href="sqlite3_8h.html#ae4b6e745ab84e922222186819ced2df6">stumpless_get_sqlite3_db</a>( db_target );</div>
<div class="line">  <span class="keywordflow">if</span>( !db ) {</div>
<div class="line">    <a class="code hl_function" href="error_8h.html#a8dea1c008afff3e4b8900987f5d8e914">stumpless_perror</a>( <span class="stringliteral">&quot;couldn&#39;t get the underlying database connection!&quot;</span> );</div>
<div class="line">    result = EXIT_FAILURE;</div>
<div class="line">    <span class="keywordflow">goto</span> cleanup_and_finish;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  sql_result = sqlite3_prepare_v2( db,</div>
<div class="line">                                   card_logs_create_sql,</div>
<div class="line">                                   -1,</div>
<div class="line">                                   &amp;card_logs_create_stmt,</div>
<div class="line">                                   NULL );</div>
<div class="line">  <span class="keywordflow">if</span>( sql_result != SQLITE_OK ) {</div>
<div class="line">    <span class="comment">// for simplicity, if this fails we simply print a warning and continue</span></div>
<div class="line">    puts( <span class="stringliteral">&quot;could not create card_logs table, perhaps it already exists?&quot;</span> );</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    sql_result = sqlite3_step( card_logs_create_stmt );</div>
<div class="line">    <span class="keywordflow">if</span>( sql_result != SQLITE_DONE ) {</div>
<div class="line">      printf( <span class="stringliteral">&quot;couldn&#39;t create the card_logs table: %s\n&quot;</span>,</div>
<div class="line">              sqlite3_errmsg( db ) );</div>
<div class="line">      result = EXIT_FAILURE;</div>
<div class="line">      <span class="keywordflow">goto</span> cleanup_and_finish;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// set the target to use our custom insert SQL instead</span></div>
<div class="line">  <a id="a9" name="a9"></a><a class="code hl_function" href="sqlite3_8h.html#aa884c29dbda69b0fd0119c339d80d1b3">stumpless_set_sqlite3_insert_sql</a>( db_target, card_logs_insert );</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code hl_function" href="error_8h.html#ae29b0a3c430cec8b9a165c98482f40e8">stumpless_has_error</a>() ) {</div>
<div class="line">    <a class="code hl_function" href="error_8h.html#a8dea1c008afff3e4b8900987f5d8e914">stumpless_perror</a>( <span class="stringliteral">&quot;couldn&#39;t set the custom insert sql&quot;</span> );</div>
<div class="line">    result = EXIT_FAILURE;</div>
<div class="line">    <span class="keywordflow">goto</span> cleanup_and_finish;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// create a new entry with some structured data</span></div>
<div class="line">  <span class="comment">// we ignore the error checking here for brevity</span></div>
<div class="line">  entry = <a id="a10" name="a10"></a><a class="code hl_function" href="entry_8h.html#ad048e3a91b9c1c58be2312562fd7bd8c">stumpless_new_entry</a>( STUMPLESS_FACILITY_USER,</div>
<div class="line">                               STUMPLESS_SEVERITY_INFO,</div>
<div class="line">                               <span class="stringliteral">&quot;card-counter&quot;</span>,</div>
<div class="line">                               <span class="stringliteral">&quot;card-played&quot;</span>,</div>
<div class="line">                               <span class="stringliteral">&quot;a card was played&quot;</span> );</div>
<div class="line"> </div>
<div class="line">  <a id="a11" name="a11"></a><a class="code hl_function" href="entry_8h.html#a48d3458a66bbafb27f2fa52707457dd8">stumpless_add_new_param_to_entry</a>( entry, <span class="stringliteral">&quot;card&quot;</span>, <span class="stringliteral">&quot;suit&quot;</span>, <span class="stringliteral">&quot;hearts&quot;</span> );</div>
<div class="line">  <a class="code hl_function" href="entry_8h.html#a48d3458a66bbafb27f2fa52707457dd8">stumpless_add_new_param_to_entry</a>( entry, <span class="stringliteral">&quot;card&quot;</span>, <span class="stringliteral">&quot;rank&quot;</span>, <span class="stringliteral">&quot;5&quot;</span> );</div>
<div class="line">  <a class="code hl_function" href="entry_8h.html#a48d3458a66bbafb27f2fa52707457dd8">stumpless_add_new_param_to_entry</a>( entry, <span class="stringliteral">&quot;player&quot;</span>, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;bill&quot;</span> );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// use our custom insert SQL to add to the card_logs table</span></div>
<div class="line">  <a id="a12" name="a12"></a><a class="code hl_function" href="target_8h.html#aea7246d94f19e7f0b28b5ae3f2012446">stumpless_add_entry</a>( db_target, entry );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// here&#39;s what the database looks like after this:</span></div>
<div class="line">  <span class="comment">// sqlite&gt; SELECT * FROM card_logs;</span></div>
<div class="line">  <span class="comment">// log_id      facility    severity    timestamp                    structured_data                                    message</span></div>
<div class="line">  <span class="comment">// ----------  ----------  ----------  ---------------------------  -------------------------------------------------  -----------------</span></div>
<div class="line">  <span class="comment">// 1           8           6           2023-11-23T19:05:33.234523Z  [card suit=&quot;hearts&quot; rank=&quot;5&quot;][player name=&quot;bill&quot;]  a card was played</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// finally, let&#39;s use a custom preparation function for more structure</span></div>
<div class="line">  <span class="comment">// first we create our new tables</span></div>
<div class="line">  sql_result = sqlite3_prepare_v2( db,</div>
<div class="line">                                   played_cards_create_sql,</div>
<div class="line">                                   -1,</div>
<div class="line">                                   &amp;played_cards_create_stmt,</div>
<div class="line">                                   NULL );</div>
<div class="line">  <span class="keywordflow">if</span>( sql_result != SQLITE_OK ) {</div>
<div class="line">    <span class="comment">// for simplicity, if this fails we simply print a warning and continue</span></div>
<div class="line">    puts( <span class="stringliteral">&quot;could not create played_cards table, perhaps it already exists?&quot;</span> );</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    sql_result = sqlite3_step( played_cards_create_stmt );</div>
<div class="line">    <span class="keywordflow">if</span>( sql_result != SQLITE_DONE ) {</div>
<div class="line">      printf( <span class="stringliteral">&quot;couldn&#39;t create the played_cards table: %s\n&quot;</span>,</div>
<div class="line">              sqlite3_errmsg( db ) );</div>
<div class="line">      result = EXIT_FAILURE;</div>
<div class="line">      <span class="keywordflow">goto</span> cleanup_and_finish;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  sql_result = sqlite3_prepare_v2( db,</div>
<div class="line">                                   taken_turns_create_sql,</div>
<div class="line">                                   -1,</div>
<div class="line">                                   &amp;taken_turns_create_stmt,</div>
<div class="line">                                   NULL );</div>
<div class="line">  <span class="keywordflow">if</span>( sql_result != SQLITE_OK ) {</div>
<div class="line">    <span class="comment">// for simplicity, if this fails we simply print a warning and continue</span></div>
<div class="line">    puts( <span class="stringliteral">&quot;could not create taken_turns table, perhaps it already exists?&quot;</span> );</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    sql_result = sqlite3_step( taken_turns_create_stmt );</div>
<div class="line">    <span class="keywordflow">if</span>( sql_result != SQLITE_DONE ) {</div>
<div class="line">      printf( <span class="stringliteral">&quot;couldn&#39;t create the taken_turns table: %s\n&quot;</span>,</div>
<div class="line">              sqlite3_errmsg( db ) );</div>
<div class="line">      result = EXIT_FAILURE;</div>
<div class="line">      <span class="keywordflow">goto</span> cleanup_and_finish;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// we only need the db, so we use this as our custom data pointer</span></div>
<div class="line">  <a id="a13" name="a13"></a><a class="code hl_function" href="sqlite3_8h.html#ae906f117d8230c6b4923f581733948c8">stumpless_set_sqlite3_prepare</a>( db_target, &amp;card_played_prepare, db );</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code hl_function" href="error_8h.html#ae29b0a3c430cec8b9a165c98482f40e8">stumpless_has_error</a>() ) {</div>
<div class="line">    <a class="code hl_function" href="error_8h.html#a8dea1c008afff3e4b8900987f5d8e914">stumpless_perror</a>( <span class="stringliteral">&quot;couldn&#39;t set the custom prepare function&quot;</span> );</div>
<div class="line">    result = EXIT_FAILURE;</div>
<div class="line">    <span class="keywordflow">goto</span> cleanup_and_finish;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// add the same entry again to see it in our new tables</span></div>
<div class="line">  <a class="code hl_function" href="target_8h.html#aea7246d94f19e7f0b28b5ae3f2012446">stumpless_add_entry</a>( db_target, entry );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// sqlite&gt; SELECT * FROM played_cards;</span></div>
<div class="line">  <span class="comment">// played_card_id  suit        rank</span></div>
<div class="line">  <span class="comment">// --------------  ----------  ----------</span></div>
<div class="line">  <span class="comment">// 1               hearts      5</span></div>
<div class="line">  <span class="comment">// sqlite&gt; SELECT * FROM taken_turns;</span></div>
<div class="line">  <span class="comment">// taken_turn_id  player_name</span></div>
<div class="line">  <span class="comment">// -------------  -----------</span></div>
<div class="line">  <span class="comment">// 1              bill</span></div>
<div class="line"> </div>
<div class="line">cleanup_and_finish:</div>
<div class="line">  sqlite3_finalize( card_logs_create_stmt );</div>
<div class="line">  sqlite3_finalize( played_cards_create_stmt );</div>
<div class="line">  sqlite3_finalize( taken_turns_create_stmt );</div>
<div class="line">  sqlite3_finalize( card_stmts[0] );</div>
<div class="line">  sqlite3_finalize( card_stmts[1] );</div>
<div class="line">  <a id="a14" name="a14"></a><a class="code hl_function" href="entry_8h.html#a0f8de0ae9cac6fcfc68f9c06601a6261">stumpless_destroy_entry_and_contents</a>( entry );</div>
<div class="line">  <a id="a15" name="a15"></a><a class="code hl_function" href="sqlite3_8h.html#a8992284d5abe5d3a5e7c1f6ebaa6f16c">stumpless_close_sqlite3_target_and_db</a>( db_target );</div>
<div class="line">  <a id="a16" name="a16"></a><a class="code hl_function" href="memory_8h.html#abe197a5a61739e3e4ac6fe9bbfa02809">stumpless_free_all</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="ttc" id="aentry_8h_html_a0f8de0ae9cac6fcfc68f9c06601a6261"><div class="ttname"><a href="entry_8h.html#a0f8de0ae9cac6fcfc68f9c06601a6261">stumpless_destroy_entry_and_contents</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION void stumpless_destroy_entry_and_contents(const struct stumpless_entry *entry)</div><div class="ttdoc">Destroys an entry as well as all elements and params that it contains, freeing any allocated memory.</div></div>
<div class="ttc" id="aentry_8h_html_a48d3458a66bbafb27f2fa52707457dd8"><div class="ttname"><a href="entry_8h.html#a48d3458a66bbafb27f2fa52707457dd8">stumpless_add_new_param_to_entry</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION struct stumpless_entry * stumpless_add_new_param_to_entry(struct stumpless_entry *entry, const char *element_name, const char *param_name, const char *param_value)</div><div class="ttdoc">Creates a new param and adds it to the given element in the given entry.</div></div>
<div class="ttc" id="aentry_8h_html_a7714fe32f587fcf407aac0728eda867f"><div class="ttname"><a href="entry_8h.html#a7714fe32f587fcf407aac0728eda867f">stumpless_get_entry_param_value_by_name</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION const char * stumpless_get_entry_param_value_by_name(const struct stumpless_entry *entry, const char *element_name, const char *param_name)</div><div class="ttdoc">Gets the value of the first param from the element with the given name in an entry.</div></div>
<div class="ttc" id="aentry_8h_html_ad048e3a91b9c1c58be2312562fd7bd8c"><div class="ttname"><a href="entry_8h.html#ad048e3a91b9c1c58be2312562fd7bd8c">stumpless_new_entry</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION struct stumpless_entry * stumpless_new_entry(enum stumpless_facility facility, enum stumpless_severity severity, const char *app_name, const char *msgid, const char *message,...)</div><div class="ttdoc">Creates a new entry with the given characteristics.</div></div>
<div class="ttc" id="aerror_8h_html_a8dea1c008afff3e4b8900987f5d8e914"><div class="ttname"><a href="error_8h.html#a8dea1c008afff3e4b8900987f5d8e914">stumpless_perror</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION void stumpless_perror(const char *prefix)</div><div class="ttdoc">Prints information about the current error to the error stream.</div></div>
<div class="ttc" id="aerror_8h_html_ae29b0a3c430cec8b9a165c98482f40e8"><div class="ttname"><a href="error_8h.html#ae29b0a3c430cec8b9a165c98482f40e8">stumpless_has_error</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION bool stumpless_has_error(void)</div><div class="ttdoc">True if the last call to a stumpless function encountered an error.</div></div>
<div class="ttc" id="amemory_8h_html_abe197a5a61739e3e4ac6fe9bbfa02809"><div class="ttname"><a href="memory_8h.html#abe197a5a61739e3e4ac6fe9bbfa02809">stumpless_free_all</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION void stumpless_free_all(void)</div><div class="ttdoc">Closes the default target if it has been opened, frees all memory allocated internally,...</div></div>
<div class="ttc" id="asqlite3_8h_html"><div class="ttname"><a href="sqlite3_8h.html">sqlite3.h</a></div><div class="ttdoc">SQLite3 targets allow logs to be sent to a SQLite3 database.</div></div>
<div class="ttc" id="asqlite3_8h_html_a8992284d5abe5d3a5e7c1f6ebaa6f16c"><div class="ttname"><a href="sqlite3_8h.html#a8992284d5abe5d3a5e7c1f6ebaa6f16c">stumpless_close_sqlite3_target_and_db</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION bool stumpless_close_sqlite3_target_and_db(const struct stumpless_target *target)</div><div class="ttdoc">Closes a SQLite3 target and its database handle.</div></div>
<div class="ttc" id="asqlite3_8h_html_aa884c29dbda69b0fd0119c339d80d1b3"><div class="ttname"><a href="sqlite3_8h.html#aa884c29dbda69b0fd0119c339d80d1b3">stumpless_set_sqlite3_insert_sql</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION struct stumpless_target * stumpless_set_sqlite3_insert_sql(struct stumpless_target *target, const char *sql)</div><div class="ttdoc">Sets the SQL statement used to insert entries into the database.</div></div>
<div class="ttc" id="asqlite3_8h_html_ae4b6e745ab84e922222186819ced2df6"><div class="ttname"><a href="sqlite3_8h.html#ae4b6e745ab84e922222186819ced2df6">stumpless_get_sqlite3_db</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION void * stumpless_get_sqlite3_db(const struct stumpless_target *target)</div><div class="ttdoc">Gets the SQLite3 database handle used by the target.</div></div>
<div class="ttc" id="asqlite3_8h_html_ae8bd442757c8a6bcbaa9c2212f68bbb3"><div class="ttname"><a href="sqlite3_8h.html#ae8bd442757c8a6bcbaa9c2212f68bbb3">stumpless_create_default_sqlite3_table</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION struct stumpless_target * stumpless_create_default_sqlite3_table(struct stumpless_target *target)</div><div class="ttdoc">Creates a table in the target's database for use with the default SQLite3 insertion behavior.</div></div>
<div class="ttc" id="asqlite3_8h_html_ae906f117d8230c6b4923f581733948c8"><div class="ttname"><a href="sqlite3_8h.html#ae906f117d8230c6b4923f581733948c8">stumpless_set_sqlite3_prepare</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION struct stumpless_target * stumpless_set_sqlite3_prepare(struct stumpless_target *target, stumpless_sqlite3_prepare_func_t preparer, void *data)</div><div class="ttdoc">Set the function used to prepare statements for entries to this target.</div></div>
<div class="ttc" id="asqlite3_8h_html_aed442f2f4b25e58f6798dc7635d491a7"><div class="ttname"><a href="sqlite3_8h.html#aed442f2f4b25e58f6798dc7635d491a7">stumpless_open_sqlite3_target</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION struct stumpless_target * stumpless_open_sqlite3_target(const char *name)</div><div class="ttdoc">Opens a SQLite3 target.</div></div>
<div class="ttc" id="astructstumpless__entry_html"><div class="ttname"><a href="structstumpless__entry.html">stumpless_entry</a></div><div class="ttdoc">A log entry.</div><div class="ttdef"><b>Definition</b> entry.h:60</div></div>
<div class="ttc" id="astructstumpless__target_html"><div class="ttname"><a href="structstumpless__target.html">stumpless_target</a></div><div class="ttdoc">A target that log entries can be sent to.</div><div class="ttdef"><b>Definition</b> target.h:140</div></div>
<div class="ttc" id="astumpless_8h_html"><div class="ttname"><a href="stumpless_8h.html">stumpless.h</a></div><div class="ttdoc">The main header file for the stumpless logging library.</div></div>
<div class="ttc" id="atarget_8h_html_ad46e8e1c808d895e5b8b349d4a02f90a"><div class="ttname"><a href="target_8h.html#ad46e8e1c808d895e5b8b349d4a02f90a">stumpless_add_message</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION int stumpless_add_message(struct stumpless_target *target, const char *message,...)</div><div class="ttdoc">Adds a message to a given target.</div></div>
<div class="ttc" id="atarget_8h_html_aea7246d94f19e7f0b28b5ae3f2012446"><div class="ttname"><a href="target_8h.html#aea7246d94f19e7f0b28b5ae3f2012446">stumpless_add_entry</a></div><div class="ttdeci">STUMPLESS_PUBLIC_FUNCTION int stumpless_add_entry(struct stumpless_target *target, const struct stumpless_entry *entry)</div><div class="ttdoc">Adds an entry into a given target.</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
